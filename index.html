function togglePump() {
  const username = localStorage.getItem("loggedInUser");
  if (!username) return;

  const desiredState = pumpOn ? false : true;

  fetch("/control", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username: username, relayState: desiredState }),
  })
  .then(res => res.text())
  .then(data => {
    console.log(data);
    pumpOn = desiredState;
    updatePumpStatus();
  })
  .catch(err => console.error(err));
}

// تحديث القراءات كل 3 ثواني
setInterval(() => {
  const username = localStorage.getItem("loggedInUser");
  if (!username) return;

  fetch(`/data?username=${username}`)
    .then(res => res.json())
    .then(data => {
      document.getElementById("temp").innerText = data.temperature.toFixed(2);
      document.getElementById("humidity").innerText = data.soil;
      pumpOn = data.relayState;
      updatePumpStatus();
    })
    .catch(err => console.error(err));
}, 3000);
