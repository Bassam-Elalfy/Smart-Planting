<script>
  const users = {
    user1: 'pass1',
    user2: 'pass2'
  };

  let pumpOn = false;
  let currentLang = 'ar';

  function showNotification(message, type = 'success') {
    const notif = document.createElement('div');
    notif.className = notification ${type};
    notif.innerText = message;
    notificationsDiv.appendChild(notif);
    setTimeout(() => {
      notif.remove();
    }, 5000);
  }

  function login(event) {
    event.preventDefault();
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();

    if (users[username] && users[username] === password) {
      document.getElementById('login').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
      document.getElementById('usernameDisplay').innerText = username;
      loadLang(currentLang);
      loadLastRun();
      fetchSensorData();
    } else {
      showNotification(texts[currentLang].loginError, 'error');
    }
  }

  function logout() {
    document.getElementById('login').style.display = 'block';
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('username').value = '';
    document.getElementById('password').value = '';
  }

  function toggleLang() {
    currentLang = currentLang === 'ar' ? 'en' : 'ar';
    loadLang(currentLang);
  }

  function loadLang(lang) {
    document.getElementById('projectTitle').innerText = texts[lang].projectName;
    document.getElementById('loginTitle').innerText = texts[lang].loginTitle;
    document.getElementById('labelUsername').innerText = texts[lang].labelUsername;
    document.getElementById('labelPassword').innerText = texts[lang].labelPassword;
    document.getElementById('loginBtn').innerText = texts[lang].loginBtn;
    document.getElementById('dashboardTitle').innerText = texts[lang].dashboardTitle;
    document.getElementById('welcomeText').innerText = texts[lang].welcomeText;
    document.getElementById('sensorReadingsTitle').innerText = texts[lang].sensorReadingsTitle;
    document.getElementById('tempLabel').innerText = texts[lang].tempLabel;
    document.getElementById('humidityLabel').innerText = texts[lang].humidityLabel;
    document.getElementById('pumpControlTitle').innerText = texts[lang].pumpControlTitle;
    document.getElementById('pumpStatusLabel').innerText = texts[lang].pumpStatusLabel;
    document.getElementById('togglePumpBtn').innerText = texts[lang].togglePumpBtn;
    document.getElementById('logoutBtn').innerText = texts[lang].logoutBtn;
    document.getElementById('langSwitch').innerText = lang === 'ar' ? 'Ø¹' : 'EN';
    updatePumpStatus();
    updateLastRunText();
  }

  function togglePump() {
    pumpOn = !pumpOn;
    updatePumpStatus();
    const now = new Date().toLocaleString();
    localStorage.setItem('lastRun', now);
    updateLastRunText();
    showNotification(pumpOn ? texts[currentLang].notificationPumpOn : texts[currentLang].notificationPumpOff);
  }

  function updatePumpStatus() {
    const pumpStatus = document.getElementById('pumpStatus');
    if (pumpOn) {
      pumpStatus.classList.remove('off');
      pumpStatus.innerText = texts[currentLang].pumpOn;
    } else {
      pumpStatus.classList.add('off');
      pumpStatus.innerText = texts[currentLang].pumpOff;
    }
  }

  function fetchSensorData() {
    // Mocked values, replace with your ThingSpeak API fetch
    const temp = Math.floor(20 + Math.random() * 10);
    const humidity = Math.floor(30 + Math.random() * 40);
    document.getElementById('temp').innerText = temp;
    document.getElementById('humidity').innerText = humidity;

    if (humidity < humidityThreshold) {
      showNotification(texts[currentLang].notificationLowHumidity, 'error');
    }

    setTimeout(fetchSensorData, 10000); // Refresh every 10s
  }

  function loadLastRun() {
    const last = localStorage.getItem('lastRun');
    if (last) {
      document.getElementById('lastRunText').innerText = ${texts[currentLang].lastRunText} ${last};
    }
  }

  function updateLastRunText() {
    const last = localStorage.getItem('lastRun');
    if (last) {
      document.getElementById('lastRunText').innerText = ${texts[currentLang].lastRunText} ${last};
    }
  }
</script>
